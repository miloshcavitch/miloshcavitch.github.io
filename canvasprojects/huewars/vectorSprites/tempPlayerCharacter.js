
var pCBody = {colorArray: ['#000000', '#918686'], symmetryLine: 0, xCenter: 677.5, yCenter: 381, width: 50, height: 70, rotation: 0, shapes: [
{symmetryBool: false, color: 1, globalAlpha: 1, type: 'polygon',positions: [

{x: 0.07142857142857142, y: -0.8461176470588235},
{x: -0.07142857142857142, y: -0.8461176470588235},
{x: -0.07142857142857142, y: -0.7284705882352941},
{x: -0.14285714285714285, y: -0.7284705882352941},
{x: -0.14285714285714285, y: -0.6696470588235294},
{x: -0.21428571428571427, y: -0.6696470588235294},
{x: -0.21428571428571427, y: -0.552},
{x: -0.14285714285714285, y: -0.552},
{x: -0.14285714285714285, y: -0.4343529411764706},
{x: -0.2857142857142857, y: -0.4343529411764706},
{x: -0.2857142857142857, y: -0.19905882352941176},
{x: -0.35714285714285715, y: -0.19905882352941176},
{x: -0.35714285714285715, y: -0.08141176470588235},
{x: -0.5, y: -0.08141176470588235},
{x: -0.5, y: 0.03623529411764706},
{x: -0.35714285714285715, y: 0.03623529411764706},
{x: -0.35714285714285715, y: 0.09505882352941177},
{x: -0.2857142857142857, y: 0.09505882352941177},
{x: -0.2857142857142857, y: 0.15388235294117647},
{x: -0.21428571428571427, y: 0.15388235294117647},
{x: -0.21428571428571427, y: 0.03623529411764706},
{x: -0.14285714285714285, y: 0.03623529411764706},
{x: -0.14285714285714285, y: 0.15388235294117647},
{x: 0.14285714285714285, y: 0.15388235294117647},
{x: 0.14285714285714285, y: 0.03623529411764706},
{x: 0.21428571428571427, y: 0.03623529411764706},
{x: 0.21428571428571427, y: 0.15388235294117647},
{x: 0.2857142857142857, y: 0.15388235294117647},
{x: 0.2857142857142857, y: 0.09505882352941177},
{x: 0.35714285714285715, y: 0.09505882352941177},
{x: 0.35714285714285715, y: 0.03623529411764706},
{x: 0.5, y: 0.03623529411764706},
{x: 0.5, y: -0.08141176470588235},
{x: 0.35714285714285715, y: -0.08141176470588235},
{x: 0.35714285714285715, y: -0.19905882352941176},
{x: 0.2857142857142857, y: -0.19905882352941176},
{x: 0.2857142857142857, y: -0.4343529411764706},
{x: 0.14285714285714285, y: -0.4343529411764706},
{x: 0.14285714285714285, y: -0.552},
{x: 0.21428571428571427, y: -0.552},
{x: 0.21428571428571427, y: -0.6696470588235294},
{x: 0.14285714285714285, y: -0.6696470588235294},
{x: 0.14285714285714285, y: -0.7284705882352941},
{x: 0.07142857142857142, y: -0.7284705882352941},
]},
{symmetryBool: true, color: 0, globalAlpha: 1, type: 'polyline',lineWidth: 4.5/218.75, positions: [

{x: 0, y: -0.8461176470588235},
{x: -0.07142857142857142, y: -0.8461176470588235},
{x: -0.07142857142857142, y: -0.7284705882352941},
{x: -0.14285714285714285, y: -0.7284705882352941},
{x: -0.14285714285714285, y: -0.6696470588235294},
{x: -0.21428571428571427, y: -0.6696470588235294},
{x: -0.21428571428571427, y: -0.552},
{x: -0.14285714285714285, y: -0.552},
{x: -0.14285714285714285, y: -0.4343529411764706},
{x: -0.2857142857142857, y: -0.4343529411764706},
{x: -0.2857142857142857, y: -0.19905882352941176},
{x: -0.35714285714285715, y: -0.19905882352941176},
{x: -0.35714285714285715, y: -0.08141176470588235},
{x: -0.5, y: -0.08141176470588235},
{x: -0.5, y: 0.03623529411764706},
{x: -0.35714285714285715, y: 0.03623529411764706},
{x: -0.35714285714285715, y: 0.09505882352941177},
{x: -0.2857142857142857, y: 0.09505882352941177},
{x: -0.2857142857142857, y: 0.15388235294117647},
{x: -0.21428571428571427, y: 0.15388235294117647},
{x: -0.21428571428571427, y: 0.03623529411764706},
{x: -0.14285714285714285, y: 0.03623529411764706},
{x: -0.14285714285714285, y: 0.15388235294117647},
{x: 0, y: 0.15058823529411763},
]}
]}
var pCGun = {colorArray: ['#000000', '#918686'], symmetryLine: 0, xCenter: 677.5, yCenter: 381, width: 50, height: 70, rotation: 0, shapes: [
{symmetryBool: false, color: 1, globalAlpha: 1, type: 'polygon',positions: [

{x: 0.03571428571428571, y: -0.31670588235294117},
{x: -0.03571428571428571, y: -0.31670588235294117},
{x: -0.03571428571428571, y: -0.02258823529411765},
{x: -0.10714285714285714, y: -0.02258823529411765},
{x: -0.10714285714285714, y: 0.03623529411764706},
{x: -0.03571428571428571, y: 0.03623529411764706},
{x: -0.03571428571428571, y: 0.0656470588235294},
{x: 0.03571428571428571, y: 0.0656470588235294},
{x: 0.03571428571428571, y: 0.03623529411764706},
{x: 0.10714285714285714, y: 0.03623529411764706},
{x: 0.10714285714285714, y: -0.02258823529411765},
{x: 0.03571428571428571, y: -0.02258823529411765},
]},
{symmetryBool: true, color: 0, globalAlpha: 1, type: 'polyline',lineWidth: 3.9000000000000004/218.75, positions: [

{x: 0, y: 0.0656470588235294},
{x: -0.03571428571428571, y: 0.0656470588235294},
{x: -0.03571428571428571, y: 0.03623529411764706},
{x: -0.10714285714285714, y: 0.03623529411764706},
{x: -0.10714285714285714, y: -0.02258823529411765},
{x: -0.03571428571428571, y: -0.02258823529411765},
{x: -0.03571428571428571, y: -0.25788235294117645},
{x: -0.03571428571428571, y: -0.25788235294117645},
{x: -0.03571428571428571, y: -0.2872941176470588},
{x: -0.03571428571428571, y: -0.2872941176470588},
{x: -0.03571428571428571, y: -0.31670588235294117},
{x: 0, y: -0.31670588235294117},
]}
]}

var PC = function(){
  this.x = 800;
  this.y = 800;
  this.width = 50;
  this.height = 70;//width and height same as above vector
  this.color = 100;
  this.health = 1;
  this.exhaustEmitters = [];
  this.exhaustEmitters.push(new ExhaustEmitter(0 - pCBody.width * 0.04, (pCBody.height * 0.1), this.color));
  this.exhaustEmitters.push(new ExhaustEmitter(pCBody.width * 0.04, (pCBody.height * 0.1), this.color));
  this.shipRotation = 0;
  this.gunRotation = 0;
  this.handling = 1;
  this.hitFrame = 30;
  this.topSpeed = this.handling * 20;
  this.horizontalMomentum = 0;
  this.verticalMomentum = 0;
  this.shootBullet = function(){
    if (true){//will later add time out for bullet cooldown
      playerBullets.push( new PlayerBullet(pCGun.width/8, this.gunRotation + Math.PI/2, this.color, this.x, this.y, 30) )
    }
  }
  this.applyMovement = function(){
    this.color = game.scrollColor;
    if (input.l && Math.hypot(this.horizontalMomentum, this.verticalMomentum) <= this.topSpeed ){
      this.horizontalMomentum -= this.handling;
    }
    if (input.r && Math.hypot(this.horizontalMomentum, this.verticalMomentum) <= this.topSpeed ){
      this.horizontalMomentum += this.handling;
    }
    if (input.u && Math.hypot(this.verticalMomentum, this.horizontalMomentum) <= this.topSpeed ){
      this.verticalMomentum -= this.handling;
    }
    if (input.d && Math.hypot(this.verticalMomentum, this.horizontalMomentum) <= this.topSpeed ){
      this.verticalMomentum += this.handling;
    }
    if (!input.l && !input.r && this.horizontalMomentum != 0){
      this.horizontalMomentum = (Math.abs(this.horizontalMomentum) - this.handling ) * Math.sign(this.horizontalMomentum);
      if (Math.abs(this.horizontalMomentum) <= 1 ){
        this.horizontalMomentum = 0;
      }
    }
    if (!input.u && !input.d && this.verticalMomentum != 0){
      this.verticalMomentum = (Math.abs(this.verticalMomentum) - this.handling ) * Math.sign(this.verticalMomentum);
      if (Math.abs(this.verticalMomentum) <= 1 ){
        this.verticalMomentum = 0;
      }
    }
    this.x += this.horizontalMomentum;
    this.y += this.verticalMomentum;
  }
  this.render = function(){
    this.applyMovement();
    ctx.translate(unit * this.x, unit * this.y);//optimize
    this.exhaustEmitters.forEach(function(emitter){
      emitter.renderParticles();
    });
    ctx.translate(unit * this.x * -1, unit *this.y * -1);
    pCBody.xCenter = pCGun.xCenter = this.x;
    pCBody.yCenter = pCGun.yCenter = this.y;
    pCBody.rotation = this.bodyRotation;
    pCBody.colorArray[0] = pCGun.colorArray[0] = "hsl(" + this.color + ", 100%, " + saturationVal + "%)";
    pCBody.colorArray[1] = pCGun.colorArray[1] = spaceColor;
    renderPseudoSprite(pCBody, ctx);
    //
    var gameMouseX = (mouse.x / (1600 * unit)) * 1600;
    var gameMouseY = (mouse.y / (1600 * unit)) * 1600;//idk if these work (will find out ) but this should convert to the games coordinates
    this.gunRotation = slopeToRadian({x: this.x, y: this.y}, {x: gameMouseX, y: gameMouseY} ) + Math.PI/2;
    pCGun.rotation = this.gunRotation + Math.PI/2;
    this.renderLaserPoint();
    renderPseudoSprite(pCGun, ctx);
    this.renderUI();
  }
  this.renderLaserPoint = function(){
    //line-length = 1836 * unit
    var x = Math.cos(this.gunRotation) * 1836;
    var y = Math.sin(this.gunRotation) * 1836;
    ctx.beginPath();
    ctx.moveTo(this.x * unit, this.y * unit);
    ctx.lineTo( (x + this.x) * unit, (y + this.y) * unit);
    ctx.strokeStyle = "hsl(" + this.color + ", 100%, " + saturationVal + "%)";
    ctx.stroke();
    ctx.closePath();
  }
  this.renderUI = function(){
    ctx.fillStyle = 'white';
    var healthPos = {x: hud.xCenter + (hud.width * hud.shapes[0].positions[6].x), y: hud.yCenter + (hud.height * hud.shapes[0].positions[6].y)};
    var healthLength = {x: Math.abs(hud.shapes[0].positions[1].x - hud.shapes[0].positions[5].x) * this.health * 34.9 ,  y: Math.abs(hud.shapes[0].positions[6].y - hud.shapes[0].positions[5].y) };
    ctx.fillStyle = "hsl(" + milo.color + ", 100%, " + saturationVal + "%)";
    ctx.strokeStyle = 'white';
    ctx.fillRect(unit * healthPos.x, unit * healthPos.y, healthLength.x * hud.width * unit, healthLength.y * hud.height * unit);
    ctx.lineWidth = 5;
    if (this.health > 0){
      ctx.strokeRect(unit * healthPos.x, unit * healthPos.y, healthLength.x * hud.width * unit, healthLength.y * hud.height * unit);
    }
    hud.colorArray[0] = "hsl(" + milo.color + ", 100%, " + saturationVal + "%)";
    renderPseudoSprite(hud, ctx);
  }
  this.checkCollision = function(){
    this.hitFrame += 1;
    var range = {left: this.x - this.width/2, right: this.x - this.width/2 + this.width, top: this.y - this.height/2 - 23, bottom: this.y - this.height/2 + this.height - 23};
    //test
    ctx.strokeStyle = 'green';
    //ctx.strokeRect(range.left * unit, range.top * unit, this.width * unit, this.height * unit);
    /*
    ctx.beginPath();
    ctx.arc( this.x * unit , (this.y - 20) * unit, 35 * unit, 0, Math.PI * 2);
    ctx.stroke();
    ctx.closePath();
    */
    if (this.x - this.width/2 <= 0){
      this.x = 1 + this.width/2;
      this.horizontalMomentum = 0;
    }
    if (this.x + this.width/2 >= 1600){
      this.x = 1600 - this.width/2;
      this.horizontalMomentum = 0;
    }
    if (range.top <= 0){
      this.y = 50 + this.width/2;
      this.verticalMomentum *= -1/2;
    }
    if (range.bottom >= 900){
      this.y = 900 - this.height/2;
      this.verticalMomentum *= -1/2;
    }
    tankBullets.forEach(function(bullet){//this needs to be converted to a for loop so we dont have to use var milo
      if (Math.hypot(Math.abs(bullet.x - milo.x), Math.abs(bullet.y - milo.y) - 20 ) <= bullet.size * 1.4){
        game.hitColor = bullet.color;
        game.multiplier = 1;
        milo.horizontalMomentum += bullet.dx/2;
        milo.verticalMomentum += bullet.dy/2;
        milo.health -= bullet.damage;
        if (milo.health < 0){
          milo.health = 0;
          explosions.push(new Explosion(milo.x, milo.y, milo.color))
          game.lives -= 1;
          //explosion animation;
          //start respawn;
          if (game.lives < 0){
            activeMode = function(){
              consistentUpdate();
              preGameOver();
            }
          } else {
            activeMode = function(){
              consistentUpdate();
              startRespawn();
            }
          }
          milo = new PC();
          screenBlinks.new(100);
        } else {
          screenBlinks.new(15);
        }
        tankBullets.splice( tankBullets.indexOf(bullet), 1 );
      }
    });
    ai.enemies.forEach(function(enemy){
      //ctx.strokeRect((enemy.x - enemy.width/2) * unit - 3, (enemy.y - enemy.height/2) * unit - 3, enemy.width * unit + 5, enemy.height * unit + 5);
      /*
      ctx.beginPath();
      ctx.arc( enemy.x * unit , enemy.y * unit, 35 * unit, 0, Math.PI * 2);
      ctx.stroke();
      */
      /*
        if ( ( (enemy.x + enemy.width/2 <= range.right && enemy.x + enemy.width/2 >= range.left) && (enemy.y + enemy.height/2 <= range.bottom && enemy.y + enemy.height/2 >= range.top) )
              || ( (enemy.x - enemy.width/2 <= range.right && enemy.x - enemy.width/2 >= range.left) && (enemy.y + enemy.height/2 <= range.bottom && enemy.y + enemy.height/2 >= range.top) )
              || ( (enemy.x + enemy.width/2 <= range.right && enemy.x + enemy.width/2 >= range.left) && (enemy.y - enemy.height/2 <= range.bottom && enemy.y - enemy.height/2 >= range.top) )
              || ( (enemy.x - enemy.width/2 <= range.right && enemy.x - enemy.width/2 >= range.left) && (enemy.y - enemy.height/2 <= range.bottom && enemy.y - enemy.height/2 >= range.top) )){
              */
        if (Math.hypot(Math.abs(enemy.x - milo.x), Math.abs(enemy.y - milo.y) ) <= 80 && milo.hitFrame >= 30){
          milo.hitFrame = 0;
          game.hitColor = enemy.color;
          game.multiplier = 1;
          screenBlinks.new(10);
          enemy.horizontalMomentum += milo.horizontalMomentum * 1/4;
          enemy.verticalMomentum += milo.verticalMomentum * 1/4;
          milo.horizontalMomentum *= -1;
          milo.verticalMomentum *= -1;
          milo.health -= 0.2;
          if (milo.health < 0){
            milo.health = 0;
            explosions.push(new Explosion(milo.x, milo.y, milo.color))
            game.lives -= 1;
            //explosion animation;
            //start respawn;
            if (game.lives < 0){
              activeMode = function(){
                consistentUpdate();
                preGameOver();
              }
            } else {
              activeMode = function(){
                consistentUpdate();
                startRespawn();
              }
            }
            milo = new PC();
            screenBlinks.new(100);
          } else {
            screenBlinks.new(10);
          }
          //milo.x += milo.horizontalMomentum;
          //milo.y += milo.verticalMomentum;
        }
    });
  }
}
var milo = new PC();
